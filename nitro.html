<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Conflict Nitro</title>
  <meta name="description" content="Supercharge your chat experience with custom emojis and more!" />
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --muted:#9aa4b2;
      --accent:#6ee7b7;
      --accent-2:#7c5cff;
      --glass: rgba(255,255,255,0.04);
      --card: linear-gradient(135deg, rgba(124,92,255,0.12), rgba(110,231,183,0.05));
      --radius:14px;
      --shadow: 0 6px 20px rgba(2,6,23,0.6);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;}
    body{
      margin:0;
      background:
        radial-gradient(1200px 600px at 10% 20%, rgba(124,92,255,0.06), transparent 8%),
        radial-gradient(900px 400px at 90% 80%, rgba(110,231,183,0.04), transparent 8%),
        var(--bg);
      color:#e6eef6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
      box-sizing:border-box;
    }

    .layout{
      width:100%;
      max-width:1100px;
      display:grid;
      grid-template-columns: 360px 1fr;
      gap:22px;
      align-items:stretch;
    }

    /* Left column: Nitro card + Emojis */
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:18px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(6px) saturate(120%);
      border:1px solid rgba(255,255,255,0.028);
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:10px;
    }
    .logo{
      width:48px;height:48px;border-radius:10px;
      background:linear-gradient(135deg,var(--accent-2),var(--accent));
      display:flex;align-items:center;justify-content:center;
      font-weight:700;font-size:18px;color:rgba(0,0,0,0.75);
      box-shadow: 0 6px 18px rgba(124,92,255,0.12), inset 0 -6px 18px rgba(0,0,0,0.08);
    }
    h1.title{margin:0;font-size:18px;letter-spacing:0.1px;}
    p.tag{margin:4px 0 0;color:var(--muted);font-size:13px;}

    .nitro-banner{
      margin-top:12px;
      padding:14px;border-radius:12px;
      background:var(--card);
      display:flex;gap:12px;align-items:center;
    }
    .nitro-badge{
      display:flex;align-items:center;justify-content:center;
      width:56px;height:56px;border-radius:12px;
      background:linear-gradient(180deg,var(--accent-2),var(--accent));
      color:#05121a;font-weight:700;font-size:20px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
    }
    .nitro-info{flex:1;}
    .nitro-info h2{margin:0;font-size:16px;}
    .nitro-info p{margin:6px 0 0;color:var(--muted);font-size:13px;}

    .nitro-actions{
      display:flex;gap:8px;margin-top:12px;
    }
    .btn{
      appearance:none;border:0;padding:10px 12px;border-radius:10px;
      cursor:pointer;font-weight:600;
    }
    .btn-primary{
      background:linear-gradient(90deg,var(--accent-2),var(--accent));
      color:#041017;box-shadow:0 8px 20px rgba(124,92,255,0.12);
    }
    .btn-ghost{
      background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent-2);
    }

    /* Emoji area */
    .emojis {
      margin-top:16px;
    }
    .emojis-header{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;
    }
    .emoji-grid{
      display:flex;flex-wrap:wrap;gap:8px;
    }
    .emoji{
      width:44px;height:44px;border-radius:8px;background:var(--glass);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;border:1px solid rgba(255,255,255,0.02);
      overflow:hidden;
    }
    .emoji img{max-width:100%;max-height:100%;display:block;object-fit:cover;}
    .small-muted{color:var(--muted);font-size:13px}

    /* Right column: Chat */
    .chat{
      display:flex;flex-direction:column;height:640px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:14px;
      box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,0.02);
    }
    .chat-header{
      display:flex;align-items:center;gap:12px;padding-bottom:8px;border-bottom:1px solid rgba(255,255,255,0.02);
    }
    .server{
      background:linear-gradient(180deg,var(--accent-2),var(--accent));
      width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;color:#041017;
    }
    .chat-title{font-size:16px;margin:0}
    .chat-sub{color:var(--muted);font-size:13px;margin-top:2px}
    .messages{
      flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:12px;
    }
    .msg{
      display:flex;gap:10px;align-items:flex-start;
    }
    .avatar{
      width:42px;height:42px;border-radius:8px;background:linear-gradient(180deg,#1f2937,#111827);
      display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--muted);
      font-size:14px;
    }
    .bubble{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02);
      max-width:72%;
    }
    .bubble .meta{font-size:12px;color:var(--muted);margin-bottom:6px}
    .message-content img.chat-emoji{height:20px;width:20px;vertical-align:middle;margin:0 4px;display:inline-block;border-radius:4px}

    .composer{
      margin-top:12px;display:flex;gap:10px;align-items:center;
      padding-top:12px;border-top:1px solid rgba(255,255,255,0.02);
    }
    .input{
      flex:1;background:rgba(255,255,255,0.02);border-radius:10px;padding:10px;border:1px solid rgba(255,255,255,0.02);
      min-height:46px;display:flex;align-items:center;gap:8px;
    }
    .text{
      flex:1;background:transparent;border:0;outline:none;color:inherit;font-size:14px;
    }
    .emoji-picker-toggle{width:36px;height:36px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.02);cursor:pointer}
    .uploader{display:none}

    /* mini modal/notice */
    .notice{
      margin-top:12px;color:var(--muted);font-size:13px;
    }

    /* Responsive */
    @media (max-width:920px){
      .layout{grid-template-columns:1fr;max-width:760px;}
      .chat{height:640px}
    }

    @media (max-width:520px){
      body{padding:14px}
      .chat{height:560px}
      .nitro-banner{flex-direction:column;align-items:flex-start}
      .nitro-badge{width:48px;height:48px}
    }
  </style>
</head>
<body>
  <main class="layout" aria-labelledby="site-title">
    <!-- Left column -->
    <section class="card" aria-label="Nitro and emoji panel">
      <div class="brand">
        <div class="logo" aria-hidden="true">CN</div>
        <div>
          <h1 id="site-title" class="title">Conflict Nitro</h1>
          <p class="tag">Supercharge your chat experience with custom emojis and more!</p>
        </div>
      </div>

      <div class="nitro-banner" role="region" aria-label="Nitro features">
        <div class="nitro-badge" aria-hidden="true">N</div>
        <div class="nitro-info">
          <h2>Unlock Conflict Nitro</h2>
          <p>Custom emojis, animated badges, higher upload limits, and exclusive perks for your server.</p>
        </div>
      </div>

      <div class="nitro-actions" aria-hidden="false">
        <button class="btn btn-primary" id="get-nitro">Get Nitro</button>
        <button class="btn btn-ghost" id="learn-more">What's included</button>
      </div>

      <div class="emojis" aria-label="Emoji picker">
        <div class="emojis-header">
          <div>
            <div class="small-muted">Emojis</div>
            <div class="small-muted" style="font-size:12px">Click any emoji to use it in chat</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <label class="small-muted" for="emoji-upload" style="cursor:pointer;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3v12" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/><path d="M8 7l4-4 4 4" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 21H3" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
              Add
            </label>
            <input id="emoji-upload" class="uploader" type="file" accept="image/*" />
          </div>
        </div>

        <div id="emojiGrid" class="emoji-grid" role="list">
          <!-- default emojis -->
        </div>
        <p class="notice">Tip: you can upload small PNG or GIF files (they become usable as emojis here locally).</p>
      </div>
    </section>

    <!-- Right column: Chat -->
    <section class="chat" aria-label="Chat panel">
      <div class="chat-header">
        <div class="server" aria-hidden="true">‚ö°</div>
        <div>
          <h3 class="chat-title">#general</h3>
          <div class="chat-sub">Welcome to Conflict ‚Äî try the emoji picker on the left.</div>
        </div>
      </div>

      <div id="messages" class="messages" aria-live="polite">
        <!-- sample system message -->
        <div class="msg">
          <div class="avatar" aria-hidden="true">CN</div>
          <div class="bubble" role="article">
            <div class="meta"><strong>System</strong> ‚Ä¢ Today</div>
            <div class="message-content">Welcome! Click emojis to add them to your message, upload your own emojis, and try the "Get Nitro" button.</div>
          </div>
        </div>
      </div>

      <div class="composer" aria-label="Message composer">
        <div class="input" role="textbox" aria-multiline="true" id="composer">
          <div contenteditable="true" class="text" id="textInput" aria-label="Message input" placeholder="Write a message..."></div>
        </div>
        <button class="emoji-picker-toggle" id="openEmoji" title="Open emoji picker" aria-label="Open emoji picker">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 20c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M15.5 11.5h.01M8.5 11.5h.01M9 15s1.5 1.5 3 1.5 3-1.5 3-1.5" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button class="btn btn-primary" id="sendBtn" aria-label="Send message">Send</button>
      </div>
    </section>
  </main>

  <template id="emoji-template">
    <div class="emoji" role="listitem" tabindex="0">
      <img alt="emoji" />
    </div>
  </template>

  <script>
    // Small utility helpers
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    // Default emoji set (small inline SVG / emoji characters)
    const defaultEmojis = [
      {type:'char', value:'üòÑ'},
      {type:'char', value:'üî•'},
      {type:'char', value:'üéâ'},
      {type:'char', value:'‚ö°'},
      {type:'char', value:'‚ù§Ô∏è'},
      {type:'char', value:'ü§ñ'},
      {type:'char', value:'üçï'},
      {type:'char', value:'üí¨'},
      {type:'char', value:'‚ú®'},
      {type:'char', value:'üëç'}
    ];

    const emojiGrid = $('#emojiGrid');
    const template = document.getElementById('emoji-template');
    const upload = $('#emoji-upload');
    const textInput = $('#textInput');
    const messages = $('#messages');
    const openEmoji = $('#openEmoji');
    const sendBtn = $('#sendBtn');
    const getNitro = $('#get-nitro');
    const learnMore = $('#learn-more');

    // store emojis as objects {type:'char'|'image', value:string}
    let emojis = [];

    function renderEmoji(e) {
      const node = template.content.cloneNode(true);
      const wrapper = node.querySelector('.emoji');
      const img = node.querySelector('img');
      if (e.type === 'char') {
        img.style.fontSize = '20px';
        img.style.lineHeight = '1';
        img.textContent = e.value;
        // the <img> tag can't show textContent; instead we wrap with a text node inside
        img.replaceWith(document.createTextNode(e.value));
        // adjust wrapper styles for text
        wrapper.style.fontSize = '20px';
        wrapper.style.display = 'flex';
        wrapper.style.alignItems = 'center';
        wrapper.style.justifyContent = 'center';
      } else {
        img.src = e.value; // data URL or URL
        img.alt = 'emoji';
      }

      wrapper.addEventListener('click', () => useEmoji(e));
      wrapper.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter' || ev.key === ' ') useEmoji(e);
      });

      emojiGrid.appendChild(wrapper);
    }

    function populateDefaults(){
      emojiGrid.innerHTML = '';
      emojis = [];
      defaultEmojis.forEach(d => {
        emojis.push(d);
        renderEmoji(d);
      });
    }

    function useEmoji(e){
      // Insert into the contenteditable as an inline image or character
      if (e.type === 'char') {
        insertTextAtCursor(e.value);
      } else {
        // insert image element (small)
        insertHtmlAtCursor('<img src="'+e.value+'" class="chat-emoji" alt="emoji">');
      }
      textInput.focus();
    }

    // Contenteditable insertion helpers
    function insertHtmlAtCursor(html) {
      const sel = window.getSelection();
      if (!sel || !sel.rangeCount) {
        textInput.focus();
        document.execCommand('insertHTML', false, html);
        return;
      }
      const range = sel.getRangeAt(0);
      range.deleteContents();
      const el = document.createElement('div');
      el.innerHTML = html;
      const frag = document.createDocumentFragment();
      let node, lastNode;
      while ((node = el.firstChild)) {
        lastNode = frag.appendChild(node);
      }
      range.insertNode(frag);
      // move caret after inserted node
      if (lastNode) {
        range.setStartAfter(lastNode);
        range.collapse(true);
        sel.removeAllRanges();
        sel.addRange(range);
      }
    }
    function insertTextAtCursor(text){
      insertHtmlAtCursor(text);
    }

    // Upload emoji images (local only)
    upload.addEventListener('change', async (ev) => {
      const file = ev.target.files && ev.target.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) {
        alert('Please upload an image file.');
        return;
      }
      if (file.size > 1024 * 200) { // 200KB soft limit
        if (!confirm('This image is larger than 200KB ‚Äî it may still work but could be large. Continue?')) return;
      }
      const data = await fileToDataURL(file);
      const obj = {type:'image', value:data};
      emojis.push(obj);
      renderEmoji(obj);
      upload.value = '';
    });

    function fileToDataURL(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Send message (renders message into messages column)
    sendBtn.addEventListener('click', sendMessage);
    textInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    function sendMessage(){
      const html = textInput.innerHTML.trim();
      if (!html) return;
      const msg = createMessageNode('You', html);
      messages.appendChild(msg);
      messages.scrollTop = messages.scrollHeight;
      textInput.innerHTML = '';
      // simulate a simple bot reply for fun if message contains "nitro" or emoji
      setTimeout(() => {
        if (/nitro/i.test(html)) {
          messages.appendChild(createMessageNode('Nitro Bot', 'Thanks for your interest! Nitro boosts uploads and unlocks badges. ‚ö°'));
        } else {
          messages.appendChild(createMessageNode('Alex', 'Nice message! '));
        }
        messages.scrollTop = messages.scrollHeight;
      }, 700);
    }

    function createMessageNode(author, htmlContent) {
      const row = document.createElement('div');
      row.className = 'msg';
      row.innerHTML = `
        <div class="avatar" aria-hidden="true">${author.slice(0,2)}</div>
        <div class="bubble">
          <div class="meta"><strong>${escapeHtml(author)}</strong> ‚Ä¢ Today</div>
          <div class="message-content"></div>
        </div>
      `;
      const content = row.querySelector('.message-content');
      // sanitize basic tags: allow <img>, text, <b>, <i>, <strong>, <em>, <br>, <a>
      content.innerHTML = sanitizeHtml(htmlContent);
      return row;
    }

    // Soft sanitize - remove scripts and on* attributes.
    function sanitizeHtml(dirty) {
      // Create a template element and parse
      const template = document.createElement('template');
      template.innerHTML = dirty;
      const walk = (node) => {
        if (node.nodeType === Node.ELEMENT_NODE) {
          // Remove event handlers
          [...node.attributes].forEach(attr => {
            if (attr.name.startsWith('on')) node.removeAttribute(attr.name);
            if (attr.name === 'href' && node.tagName === 'A') {
              // allow only http(s)
              try {
                const url = new URL(attr.value, location.href);
                if (!['http:','https:'].includes(url.protocol)) node.removeAttribute('href');
              } catch(e){ node.removeAttribute('href'); }
            }
          });
          // only allow certain tags
          const allowed = ['IMG','B','I','STRONG','EM','BR','A','SPAN'];
          if (!allowed.includes(node.tagName)) {
            // replace node with its children
            const parent = node.parentNode;
            while (node.firstChild) parent.insertBefore(node.firstChild, node);
            parent.removeChild(node);
            return;
          } else {
            if (node.tagName === 'IMG') {
              // ensure src is data: or https
              const src = node.getAttribute('src') || '';
              if (!src.startsWith('data:') && !src.startsWith('https:')) node.remove();
              else {
                node.classList.add('chat-emoji');
                node.setAttribute('alt', 'emoji');
                node.setAttribute('loading','lazy');
              }
            }
          }
        }
        // iterate children (copy because live list)
        Array.from(node.childNodes).forEach(child => walk(child));
      };
      Array.from(template.content.childNodes).forEach(child => walk(child));
      return template.innerHTML;
    }

    function escapeHtml(s){ return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    // Toggle emoji grid focus when clicking the emoji button (simple highlight)
    openEmoji.addEventListener('click', () => {
      const first = emojiGrid.querySelector('.emoji');
      if (first) {
        first.focus();
        // small visual bounce by temporarily scaling
        first.animate([{transform:'translateY(0)'},{transform:'translateY(-4px)'},{transform:'translateY(0)'}], {duration:220});
      }
    });

    // Nitro button actions
    getNitro.addEventListener('click', () => {
      // small demo modal behavior using browser confirm for simplicity
      const go = confirm('Would you like to simulate activating Conflict Nitro for your account? (This demo is local only.)');
      if (go) {
        alert('Nice! Nitro simulated: your upload limit increased and you unlocked a special badge. (Local demo only.)');
      }
    });
    learnMore.addEventListener('click', () => {
      alert('Conflict Nitro provides: custom emojis, animated badges, higher file upload limits, and exclusive server perks. This demo is local-only and does not process payments.');
    });

    // initialize
    populateDefaults();

    // expose for debugging in console (optional)
    window.ConflictNitro = { emojis, populateDefaults, useEmoji };

  </script>
</body>
</html>
